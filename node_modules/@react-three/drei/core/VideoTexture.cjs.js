"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("three"),r=require("@react-three/fiber"),n=require("suspend-react");function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var u,i,c=o(e),s=o(t);const a="undefined"!=typeof window&&"function"==typeof(null==(u=window.document)?void 0:u.createElement)&&"string"==typeof(null==(i=window.navigator)?void 0:i.userAgent);let l=null;function d(t,{unsuspend:u="loadedmetadata",start:i=!0,crossOrigin:c="anonymous",muted:d=!0,loop:f=!0,hls:p={},...m}={}){const g=new URL("string"==typeof t?t:"",window.location.href),v=e.useRef(null),w=e.useRef(null),y=r.useThree((e=>e.gl)),h=n.suspend((()=>new Promise((async e=>{const r=Object.assign(document.createElement("video"),{src:"string"==typeof t&&t||void 0,srcObject:t instanceof MediaStream&&t||void 0,crossOrigin:c,loop:f,muted:d,...m});if(w.current=r,"string"==typeof t){const e=v.current=await async function(e,t){var r;return a&&e.pathname.endsWith(".m3u8")&&(null!==(r=l)&&void 0!==r||(l=await Promise.resolve().then((function(){return o(require("hls.js"))}))),l.default.isSupported())?new l.default({...t}):null}(g,p);e?(e.attachMedia(r),e.on("hlsMediaAttached",(()=>{e.loadSource(t)}))):r.src=t}else t instanceof MediaStream&&(r.srcObject=t);const n=new s.VideoTexture(r);"colorSpace"in n?n.colorSpace=y.outputColorSpace:n.encoding=y.outputEncoding,r.addEventListener(u,(()=>e(n)))}))),[t]);return e.useEffect((()=>(i&&h.image.play(),()=>{v.current&&(v.current.destroy(),v.current=null)})),[h,i]),h}exports.VideoTexture=({children:e,src:t,...r})=>{const n=d(t,r);return c.createElement(c.Fragment,null,null==e?void 0:e(n))},exports.useVideoTexture=d;
